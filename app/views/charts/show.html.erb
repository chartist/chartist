

<canvas id="canvas" style="display:none;"></canvas>

<div class = "row">
  <div class="col-sm-9 col-md-9 pull-left">    
    <div class="thumbnail chart_container">

      <div class = "chart-graphic">
        <a class="popup-link popup" href="<%= chart_widget_url(@chart)%>"><%= render @chart %></a>
      </div>

      <div class = "caption">
        <h1><%= @chart.name %></h1>
          
        <div class= "chart-about" >
          <p class="chart-datetime"><strong>Added <%= (@chart.created_at).strftime("%a %b %d, %Y") %></strong></p>
          <p><%= @chart.description %></p>
          <p>Dashboards: <% if @chart.dashboards.any? %>
            <% @chart.dashboards.each do |dashboard| %>
               <%= link_to dashboard.title, dashboard_path(dashboard) %>
            <% end %>
          <% end %></p>
        </div>

        <div class = "chart-embed">
            <%= render 'layouts/share', :chart => @chart %>
        </div>

        <div class="btn-group edit-chart">

          <div class="btn-group">
            <button type="button" class="btn btn-default dropdown-toggle" data-toggle = "dropdown">
              <%= icon('fa fa-download') %>
              Download
              <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" role="menu">
              <li>
                <%= link_to ' PNG', '#', id: 'download-btn', data: { filename: @chart.name.parameterize + '.png' } %>
              </li>
              <li>
                <%= link_to ' CSV', chart_path(format: "csv"), id: 'downloacsv-b', download: @chart.name.parameterize +  '.csv' %>
              </li>
            </ul>
          </div>

          <button type="button" class='my_clip_button btn btn-default' data-clipboard-text="<iframe src='<%= chart_widget_url(@chart)%>' frameBorder='0'></iframe>" id='d_clip_button' title='Click me to copy to embed the chart.'><%= icon("fa fa-files-o") %> Embed chart</button>
         
          <%= link_to icon('fa fa-pencil') + ' Edit', edit_chart_path(@chart), type: "button", class: 'btn btn-default', id: 'edit-btn' if @chart.user == current_user %>
   
          <%= link_to icon('fa fa-trash-o') + ' Delete', chart_path(@chart), method: :delete, type: "button", class: 'btn btn-danger', id: 'delete-btn' if @chart.user == current_user %>

          <div class="btn-group">
            <% if current_user %>
            <%= link_to icon('fa fa-thumb-tack') + 'Pin' + ' <span class="caret"></span>'.html_safe, dashboard_path(current_user.dashboards.first, chart_id: @chart.id), method: :patch, id: 'pin', class: 'btn btn-success dropdown-toggle', "data-toggle" => "dropdown" %> 
              <ul class="dropdown-menu" role="menu">
               <% current_user.dashboards.each do |dashboard| %>
              <li><%= link_to dashboard.title, dashboard_path(dashboard) %></li>
              <% end %>
            <% end %>
            </ul>
          </div>
        

        </div>
      </div>
    </div>

  </div>
  <div class="col-sm-3 col-md-3 pull-right">
    <div class = "thumbnail">
      <%= image_tag gravatar_url(@chart.user) %>
      <div class="caption">
        <h1><%= @chart.user.username %></h1>
        <p><%= @chart.user.bio %></p>
        <p><a href= "mailto:<%= @chart.user.email %>"><i class="fa fa-envelope">
              Contact</i></a></p>
      </div>
    </div>
  </div>
</div>
